<div *ngIf="showLoading">
	<loading-indicator></loading-indicator>
</div>
<div id="content">
	<p-growl [value]="msgs"></p-growl>
	<div class="row">
		<div class="page-header">
			<div class="btn-back" (click)="onRegresarBusquedaLicencia()"><i class="ic-arrow-back"></i></div>
			<sa-big-breadcrumbs [items]="['Licencia ']" icon="group"></sa-big-breadcrumbs>
		</div>
	<div class="col-lg-12">
					<div class="well well-sm well-light">
								<div class="padding-10">
									<div>
										<fieldset>
											<legend>Datos</legend>
											<div class="smart-form">
												<div class="row">
													<section class="col col-4">
														<label>Empleado<span style="color: red">*</span></label>
														<label class="input state-disabled" *ngIf="!storeSessionFilter.isNew">
															<i class="icon-append fa fa-search"></i>
															<ng2-completer [(ngModel)]="licencia.nombreEmpleado"
																		   [dataService]="dataServiceEmpleado"
																		   [minSearchLength]="0"
																		   (selected)="selectEmpleado($event)"
																		   [disableInput]="true">
															</ng2-completer>
														</label>
														<label class="input" *ngIf="storeSessionFilter.isNew">
															<i class="icon-append fa fa-search"></i>
															<ng2-completer
																		   [(ngModel)]="licencia.nombreEmpleado"
																		   [dataService]="dataServiceEmpleado"
																		   [minSearchLength]="0"
																		   (selected)="selectEmpleado($event)">
															</ng2-completer>
														</label>
													</section>
													<section class="col col-md-4">
														<label>Jefe Inmediato<span style="color: red">*</span></label>
														<label class="input state-disabled" *ngIf="!storeSessionFilter.isNew">
															<kendo-dropdownlist id="idJefeInmediatoReq1"
																	[data]="historiasLaboralesActuales"
																	[textField]="'jefeInmediato'"
																	[valueField]="'idJefeInmediato'"
																	[defaultItem]="defaultItemHistoriaLaboral"
																	[(ngModel)]="historiaLaboralActual.idJefeInmediato"
																	(selectionChange)="selectJefeInmediato($event)"
																	[valuePrimitive]="true" style="width: 100%;"
																	[disabled]="!isAuthorized('Editar') || !storeSessionFilter.isNew">
															<ng-template kendoDropDownListNoDataTemplate></ng-template></kendo-dropdownlist>
														</label>
														<label class="input" *ngIf="storeSessionFilter.isNew">
															<kendo-dropdownlist id="idJefeInmediatoReq2"
																				[data]="historiasLaboralesActuales"
																				[textField]="'jefeInmediato'"
																				[valueField]="'idJefeInmediato'"
																				[defaultItem]="defaultItemHistoriaLaboral"
																				[(ngModel)]="historiaLaboralActual.idJefeInmediato"
																				(selectionChange)="selectJefeInmediato($event)"
																				[valuePrimitive]="true" style="width: 100%;">
															<ng-template kendoDropDownListNoDataTemplate></ng-template></kendo-dropdownlist>
														</label>
													</section>
													<section class="col col-md-4">
														<label>Per&iacute;odo</label>
														<label class="input state-disabled">
															<input type="text" [(ngModel)]="periodoEmpleadoActual.periodo" disabled="disabled"/>
														</label>
													</section>
												</div>
												<div class="row">
													<section class="col col-4">
														<label>Tipo de Licencia<span style="color: red">*</span></label>
														<label class="input state-disabled" *ngIf="!storeSessionFilter.isNew">
															<kendo-dropdownlist id="idTipoLicenciaReq1"
																				[data]="tipoLicencia"
																				[textField]="'nombre'"
																				[defaultItem]="defaultItem"
																				[valuePrimitive] = "true"
																				[valueField]="'idTipoLicencia'" style="width: 100%;"
																				[(value)]="licencia.idTipoLicencia"
																				(selectionChange)="cargarTipoLicencia($event)"
																				[disabled]="!isAuthorized('Editar') || !storeSessionFilter.isNew">
															<ng-template kendoDropDownListNoDataTemplate></ng-template></kendo-dropdownlist>
														</label>
														<label class="input" *ngIf="storeSessionFilter.isNew">
															<kendo-dropdownlist id="idTipoLicenciaReq2"
																				[data]="tipoLicencia"
																				[textField]="'nombre'"
																				[defaultItem]="defaultItem"
																				[valuePrimitive] = "true"
																				[valueField]="'idTipoLicencia'" style="width: 100%;"
																				[(value)]="licencia.idTipoLicencia"
																				(selectionChange)="cargarTipoLicencia($event)">
															<ng-template kendoDropDownListNoDataTemplate></ng-template></kendo-dropdownlist>
														</label>
													</section>
													<section class="col col-md-8">
														<label>Comentario<span style="color: red">*</span></label>
														<label class="input state-disabled" *ngIf="!storeSessionFilter.isNew">
															<input id="comentarioReq1" type="text" [(ngModel)]="licencia.comentario"
																   (keyup)="changeComentario()"
																   [disabled]="!isAuthorized('Editar')" disabled="disabled"/>
														</label>
														<label class="input" *ngIf="storeSessionFilter.isNew">
															<input id="comentarioReq2" type="text" [(ngModel)]="licencia.comentario"
																   (keyup)="changeComentario()"/>
														</label>
													</section>
												</div>
												<div class="row">
													<section class="col col-md-2">
														<label>Fecha Inicio<span style="color: red">*</span></label>
														<label class="input state-disabled" *ngIf="!storeSessionFilter.isNew">
															<i class="icon-append fa fa-calendar"></i>
															<input type="text" id="fechaInicioReq1"
																   placeholder="Seleccionar una Fecha"
																   [(ngModel)]="licencia.fechaInicio"
																   (change)="onChangeFechaInicio($event)"
																   readonly="readonly"
																   [disabled]="!isAuthorized('Editar')" disabled="disabled"
																   saUiDatepicker/>
														</label>
														<label class="input" *ngIf="storeSessionFilter.isNew">
															<i class="icon-append fa fa-calendar"></i>
															<input type="text" id="fechaInicioReq2"
																   saUiDatepicker
																   placeholder="Seleccionar una Fecha"
																   [(ngModel)]="licencia.fechaInicio"
																   (change)="onChangeFechaInicio($event)"
																   readonly="readonly"/>
														</label>
													</section>
													<section class="col col-md-2">
														<label>Fecha Fin<span style="color: red">*</span></label>
														<label class="input state-disabled" *ngIf="!storeSessionFilter.isNew">
															<i class="icon-append fa fa-calendar"></i>
															<input type="text" id="fechaFinReq1"
																   saUiDatepicker
																   placeholder="Seleccionar una Fecha"
																   [(ngModel)]="licencia.fechaFin"
																   (change)="onChangeFechaFin($event)" readonly="readonly"
																   [disabled]="!isAuthorized('Editar')" disabled="disabled"/>
														</label>
														<label class="input" *ngIf="storeSessionFilter.isNew">
															<i class="icon-append fa fa-calendar"></i>
															<input type="text" id="fechaFinReq2"
																   saUiDatepicker
																   placeholder="Seleccionar una Fecha"
																   [(ngModel)]="licencia.fechaFin"
																   (change)="onChangeFechaFin($event)" readonly="readonly"/>
														</label>
													</section>
													<section class="col col-md-2">
														<label>D&iacute;as de Licencia</label>
														<label class="input state-disabled">
															<input type="text" [(ngModel)]="licencia.dias" [disabled]="!isAuthorized('Editar')"
																   readonly="readonly" disabled="disabled"/>
														</label>

													</section>
													<section class="col col-md-2">
														<label>Todo el d&iacute;a</label>
														<label class="select state-disabled" *ngIf="!storeSessionFilter.isNew">
															<input type="checkbox"
																   [(ngModel)]="licencia.diaEntero"
																   [disabled]="isAuthorized('Editar')"
																   (change)="cambiarTodoDia($event)"
																   readonly="readonly"
																   disabled="disabled">
														</label>
														<label class="select" *ngIf="storeSessionFilter.isNew">
															<input type="checkbox" [(ngModel)]="licencia.diaEntero"
																   (change)="cambiarTodoDia($event)">
														</label>
													</section>
												</div>
												<div class="row" *ngIf="!isCheckedTodoDia">
													<section class="col col-md-2">
														<label>Hora Inicio</label>
														<label class="input state-disabled" *ngIf="!storeSessionFilter.isNew">
															<p-inputMask id="horaInicio1" mask="99:99" [(ngModel)]="licencia.horaInicio"
																		 placeholder="00:00" [disabled]="isAuthorized('Editar')"></p-inputMask>
														</label>
														<label class="input" *ngIf="storeSessionFilter.isNew">
															<p-inputMask id="horaInicio2" mask="99:99" [(ngModel)]="licencia.horaInicio" placeholder="00:00"></p-inputMask>
														</label>
													</section>
													<section class="col col-md-2">
														<label>Hora Fin</label>
														<label class="input state-disabled" *ngIf="!storeSessionFilter.isNew">
															<p-inputMask id="horaFin1" mask="99:99" [(ngModel)]="licencia.horaFin"
																		 [disabled]="isAuthorized('Editar')" placeholder="00:00"></p-inputMask>
														</label>
														<label class="input" *ngIf="storeSessionFilter.isNew">
															<p-inputMask id="horaFin2" mask="99:99" [(ngModel)]="licencia.horaFin" placeholder="00:00"></p-inputMask>
														</label>
													</section>
												</div>
												<div class="row">
													<section class="col col-md-8">
														<label>Comentario Resoluci&oacute;n</label>
														<label class="input state-disabled">
															<input id="comentarioResol" type="text" [(ngModel)]="licencia.comentarioResolucion"
																   [disabled]="true"/>
														</label>
													</section>
												</div>
											</div>
										</fieldset>

									</div>
								</div>

								<div class="padding-10" style="padding-top:20px!important">
									<div>
										<legend>Anexar Documentos</legend>
											<fieldset>
												<div class="col-12 text-right padding-bottom-10">
													<button (click)="agregarDocumento()" class="btn btn-default"
															*ngIf="this.licencia.estado=='E' || !storeSessionFilter.isNew "><i class="fa fa-plus"></i>Agregar
													</button>
												</div>
											</fieldset>
											<fieldset>
												<kendo-grid
														[data]="view"
														[pageSize]="pageSize"
														[skip]="skip"
														[pageable]="true"
														(pageChange)="pageChangeDocumentoLicencia($event)">

													<kendo-grid-column field="idDocumentoEmpleado" title=" " width="40px" >
														<template kendoGridCellTemplate let-dataItem>
															<div class="text-center">
																<a href="javascript:void(0)" class="link" (click)="onDelete(dataItem)">
																	<span class="fa fa-trash-o"></span></a>
															</div>
														</template>
													</kendo-grid-column>
													<kendo-grid-column field="nombre" title="Nombre"></kendo-grid-column>
													<kendo-grid-column field="idDocumentoEmpleado" title="Archivo">
														<template kendoGridCellTemplate let-dataItem>
															<div class="text-center">
																<a href="javascript:void(0)" class="link" (click)="onViewDocument(dataItem)">
																	<span class="fa fa-download"></span> Descargar</a>
															</div>
														</template>
													</kendo-grid-column>

												</kendo-grid>
												<editar-consulta-licencia-anexar [model]="dataItem" (cancel)="onCancel()" (save)="onSave($event)"></editar-consulta-licencia-anexar>
											</fieldset>

									</div>

								</div>
						<div class="padding-10" *ngIf="storeSessionFilter.isNew">
							<div class="bottom-bar">
								<button (click)="showMessageLicencia()" class="btn btn-primary" id="btnGuardar">Solicitar
									Licencia
								</button>
							</div>
						</div>
						<div class="padding-10" *ngIf="!storeSessionFilter.isNew">
							<div class="bottom-bar">
								<button (click)="showMessageLicencia()" class="btn btn-primary" id="btnGuardar2">Actualizar
									Licencia
								</button>
							</div>
						</div>
					</div>
			</div>
		</div>
	<kendo-dialog *ngIf="confirmActive" (close)="onCloseLicencia()">

		<kendo-dialog-titlebar style="background-color: #E5702A;">
			Confirmaci&oacute;n
		</kendo-dialog-titlebar>
		<div class="modal-body">
			<div class="smart-form">

				<div class="row">
					<section class="col col-md-12 text-align-center">
						<label class="control-label">La solicitud se enviara a su jefe. ¿Desea continuar?</label>
					</section>
				</div>
			</div>
		</div>
		<div class="modal-footer">
			<button type="button" class="btn btn-default" (click)="onActualizarLicenciaEmpleado($event)"> Guardar
			</button>
			<button type="button" class="btn btn-default" (click)="onCancel($event)"> Cancelar
			</button>
		</div>
	</kendo-dialog>
</div>